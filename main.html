<html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    </head>
    <body>
    <div class="navbar"><h1>Smoke monitoring station</h1></div>
    <div class="wrapper">

        <div id="chart-pm10"></div>
        <div id="chart-pm2_5"></div>
        <script>
          
            Plotly.plot('chart-pm10',[{
                y:[0],
                type:'line'
            }]);

            Plotly.plot('chart-pm2_5',[{
                y:[0],
                type:'line'
            }]);
            
            var cnt = 0;
            
            async function update()
            {
                let response = await fetch("measurements");
                let value = await response.json();
                Plotly.extendTraces('chart-pm10',{ y:[[value['pm10']]]}, [0]);
                Plotly.extendTraces('chart-pm2_5',{ y:[[value['pm2_5']]]}, [0]);
                setTimeout(update, 1000); 
            }

            setTimeout(update, 1000); 

            setInterval(function(){
                cnt++;
                if(cnt > 20) {
                    Plotly.relayout('chart-pm10',{
                        xaxis: {
                            range: [cnt-20,cnt]
                        }
                    });

                    Plotly.relayout('chart-pm2_5',{
                        xaxis: {
                            range: [cnt-20,cnt]
                        }
                    });
                }
            },1000);
        </script>
    </div>
    </body>
</html>
