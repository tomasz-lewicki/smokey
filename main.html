<html>
    <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    </head>
    <body>
    <div class="navbar"><h1>Smoke monitoring station</h1></div>
    <div class="wrapper">

        <div id="chart-pm10"></div>
        <div id="chart-pm2_5"></div>
        <script>


            var layout_pm10 = {
            title: 'PM 10 [ug/m3]',
            xaxis: {
                type: 'date'
            },
            yaxis: {
                autorange: true,
                range: [0,50],
                type: 'linear'
            }
            };

            var layout_pm2_5 = Object.assign({}, layout_pm10)
            layout_pm2_5.title = 'PM 2.5 [ug/m3]'

            Plotly.plot('chart-pm10',[{
                x: [new Date()],
                y:[0],
                type:'line'
            }], layout_pm10);


            // start PM2.5 plot
            Plotly.plot('chart-pm2_5',[{
                x: [new Date()],
                y:[0],
                type:'line'
            }], layout_pm2_5);
            
            var cnt = 0;
            
            async function update()
            {
                let response = await fetch("measurements");
                let value = await response.json();
                Plotly.extendTraces('chart-pm10', {x: [[new Date()]], y:[[value['pm10']]]}, [0]);
                Plotly.extendTraces('chart-pm2_5',{x: [[new Date()]], y:[[value['pm2_5']]]}, [0]);
                setTimeout(update, 1000); 
            }

            setTimeout(update, 1000); 

            setInterval(function(){
                cnt++;
                if(cnt > 20) {
                    Plotly.relayout('chart-pm10',{
                        xaxis: {
                            range: [new Date() - 20000, new Date()]
                        }
                    });

                    Plotly.relayout('chart-pm2_5',{
                        xaxis: {
                            range: [new Date() - 20000, new Date()]
                        }
                    });
                }
            },1000);
        </script>
    </div>
    </body>
</html>
